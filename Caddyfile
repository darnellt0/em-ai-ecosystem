# Caddy reverse proxy configuration for Elevated Movements

{
  # Global settings
  auto_https off
  admin 0.0.0.0:2019
}

# Main domain routing - dashboard + API through reverse proxy
localhost:80 {
  # Security headers (apply to all routes)
  header {
    X-Content-Type-Options "nosniff"
    X-Frame-Options "DENY"
    X-XSS-Protection "1; mode=block"
    Strict-Transport-Security "max-age=31536000; includeSubDomains"
    Access-Control-Allow-Origin "*"
    Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Access-Control-Allow-Headers "Content-Type, Authorization"
  }

  # Logging
  log {
    output stdout
    format json
  }

  # API endpoints - route to API container
  reverse_proxy /api/* api:3000
  reverse_proxy /health api:3000

  # Dashboard - route everything else to dashboard container
  reverse_proxy dashboard:3001
}

# n8n configuration
n8n.localhost {
  reverse_proxy n8n:5678
}

# API-only configuration
api.localhost {
  reverse_proxy api:3000
}
