{"version":3,"sources":["../../../../../../packages/dashboard/lib/apiClient.ts","../../../../../../packages/dashboard/components/agent-runner.tsx"],"sourcesContent":["const RAW_API_BASE = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:4000';\n\nexport const API_BASE = RAW_API_BASE.replace(/\\/$/, '');\n\nexport async function fetchJson<T>(path: string, init?: RequestInit): Promise<T> {\n  const res = await fetch(`${API_BASE}${path}`, {\n    ...init,\n    headers: {\n      'Content-Type': 'application/json',\n      ...(init?.headers || {}),\n    },\n    cache: 'no-store',\n  });\n\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(`Request failed (${res.status}) ${text}`);\n  }\n\n  return res.json();\n}\n","\"use client\";\r\n\r\nimport { FormEvent, useMemo, useState } from 'react';\nimport { API_BASE } from '@/lib/apiClient';\nimport type { AgentConfig, AgentInputField } from '@/types/emAiAgents';\n\r\ninterface AgentRunnerProps {\r\n  agent: AgentConfig;\r\n}\r\n\r\ntype FormState = Record<string, any>;\r\n\r\nfunction getInitialValue(field: AgentInputField) {\n  if (field.defaultValue !== undefined) {\n    return field.defaultValue;\n  }\r\n\r\n  switch (field.type) {\r\n    case 'multi-select':\r\n      return [];\r\n    case 'boolean':\r\n      return false;\r\n    case 'number':\r\n      return '';\r\n    default:\r\n      return '';\r\n  }\r\n}\r\n\r\nexport function AgentRunner({ agent }: AgentRunnerProps) {\r\n  const [formState, setFormState] = useState<FormState>(() =>\r\n    agent.inputSchema.reduce<FormState>((acc, field) => {\r\n      acc[field.id] = getInitialValue(field);\r\n      return acc;\r\n    }, {})\r\n  );\r\n  const [isSubmitting, setSubmitting] = useState(false);\r\n  const [output, setOutput] = useState<string | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const runEndpoint = useMemo(() => `${API_BASE}/em-ai/agents/${agent.id}/run`, [agent.id]);\n\r\n  function handleFieldChange(field: AgentInputField, value: any) {\r\n    setFormState((prev) => ({\r\n      ...prev,\r\n      [field.id]: value,\r\n    }));\r\n  }\r\n\r\n  async function handleSubmit(event: FormEvent<HTMLFormElement>) {\r\n    event.preventDefault();\r\n    setError(null);\r\n    setOutput(null);\r\n    setSubmitting(true);\r\n\r\n    try {\r\n      const res = await fetch(runEndpoint, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ input: formState }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const message = await res.text();\r\n        throw new Error(message || 'Agent run failed');\r\n      }\r\n\r\n      const data = await res.json();\r\n      const text = data?.result?.outputText ?? JSON.stringify(data, null, 2);\r\n      setOutput(text);\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Unknown error running agent');\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  }\r\n\r\n  function renderField(field: AgentInputField) {\r\n    const baseClasses =\r\n      'w-full rounded-xl border border-white/15 bg-white/5 px-4 py-3 text-white focus:border-emerald-300/70 focus:outline-none focus:ring-0';\r\n\r\n    switch (field.type) {\r\n      case 'textarea':\r\n        return (\r\n          <textarea\r\n            id={field.id}\r\n            name={field.id}\r\n            required={field.required}\r\n            placeholder={field.placeholder}\r\n            className={`${baseClasses} min-h-[120px] resize-y`}\r\n            value={formState[field.id] ?? ''}\r\n            onChange={(event) => handleFieldChange(field, event.target.value)}\r\n          />\r\n        );\r\n      case 'select':\r\n        return (\r\n          <select\r\n            id={field.id}\r\n            name={field.id}\r\n            required={field.required}\r\n            className={`${baseClasses} bg-[#050608]`}\r\n            value={formState[field.id] ?? ''}\r\n            onChange={(event) => handleFieldChange(field, event.target.value)}\r\n          >\r\n            <option value=\"\" disabled>\r\n              {field.placeholder || 'Select an option'}\r\n            </option>\r\n            {(field.options || []).map((option) => (\r\n              <option key={option.value} value={option.value} className=\"bg-[#050608] text-black\">\r\n                {option.label}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        );\r\n      case 'multi-select':\r\n        return (\r\n          <select\r\n            id={field.id}\r\n            name={field.id}\r\n            multiple\r\n            className={`${baseClasses} bg-[#050608]`}\r\n            value={formState[field.id] ?? []}\r\n            onChange={(event) =>\r\n              handleFieldChange(\r\n                field,\r\n                Array.from(event.target.selectedOptions).map((option) => option.value)\r\n              )\r\n            }\r\n          >\r\n            {(field.options || []).map((option) => (\r\n              <option key={option.value} value={option.value} className=\"bg-[#050608] text-black\">\r\n                {option.label}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        );\r\n      case 'number':\r\n        return (\r\n          <input\r\n            id={field.id}\r\n            name={field.id}\r\n            type=\"number\"\r\n            required={field.required}\r\n            placeholder={field.placeholder}\r\n            className={baseClasses}\r\n            value={formState[field.id] ?? ''}\r\n            onChange={(event) => handleFieldChange(field, event.target.value === '' ? '' : Number(event.target.value))}\r\n          />\r\n        );\r\n      case 'boolean':\r\n        return (\r\n          <label className=\"inline-flex items-center gap-3 text-white/80\">\r\n            <input\r\n              id={field.id}\r\n              name={field.id}\r\n              type=\"checkbox\"\r\n              className=\"h-4 w-4 rounded border-white/30 bg-transparent text-emerald-300 focus:ring-emerald-500\"\r\n              checked={Boolean(formState[field.id])}\r\n              onChange={(event) => handleFieldChange(field, event.target.checked)}\r\n            />\r\n            <span>{field.placeholder || 'Yes'}</span>\r\n          </label>\r\n        );\r\n      default:\r\n        return (\r\n          <input\r\n            id={field.id}\r\n            name={field.id}\r\n            type=\"text\"\r\n            required={field.required}\r\n            placeholder={field.placeholder}\r\n            className={baseClasses}\r\n            value={formState[field.id] ?? ''}\r\n            onChange={(event) => handleFieldChange(field, event.target.value)}\r\n          />\r\n        );\r\n    }\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"grid gap-8 lg:grid-cols-[minmax(0,1fr)_minmax(0,0.85fr)]\">\r\n      <div className=\"space-y-6 rounded-2xl border border-white/10 bg-white/5 p-6\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <p className=\"text-sm uppercase tracking-[0.3em] text-white/50\">Input</p>\r\n            <h3 className=\"mt-1 text-2xl font-semibold text-white\">Personalize the agent</h3>\r\n          </div>\r\n          <span className=\"rounded-full border border-white/20 px-4 py-1 text-xs uppercase tracking-[0.2em] text-white/70\">\r\n            {agent.inputSchema.length} fields\r\n          </span>\r\n        </div>\r\n\r\n        <div className=\"space-y-5\">\r\n          {agent.inputSchema.map((field) => (\r\n            <div key={field.id} className=\"space-y-2\">\r\n              <div className=\"flex items-center justify-between text-sm\">\r\n                <label htmlFor={field.id} className=\"text-white\">\r\n                  {field.label}\r\n                </label>\r\n                {field.required && <span className=\"text-xs uppercase tracking-[0.2em] text-rose-200\">Required</span>}\r\n              </div>\r\n              {renderField(field)}\r\n              {field.helperText && <p className=\"text-xs text-white/60\">{field.helperText}</p>}\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        <button\r\n          type=\"submit\"\r\n          disabled={isSubmitting}\r\n          className=\"mt-4 inline-flex w-full items-center justify-center rounded-xl bg-emerald-400/90 px-4 py-3 text-lg font-semibold text-black transition hover:bg-emerald-300 disabled:cursor-not-allowed disabled:bg-white/30\"\r\n        >\r\n          {isSubmitting ? 'Running…' : 'Run Agent'}\r\n        </button>\r\n\r\n        {error && <p className=\"rounded-xl border border-rose-500/40 bg-rose-500/10 px-4 py-3 text-sm text-rose-100\">{error}</p>}\r\n      </div>\r\n\r\n      <div className=\"space-y-4 rounded-2xl border border-white/10 bg-white/5 p-6\">\r\n        <p className=\"text-sm uppercase tracking-[0.3em] text-white/50\">Output</p>\r\n        <h3 className=\"text-2xl font-semibold text-white\">Results</h3>\r\n        <div className=\"min-h-[240px] rounded-xl border border-white/5 bg-black/40 p-4 text-sm text-white/80\">\r\n          {isSubmitting && <p className=\"text-white/60\">Running {agent.name}…</p>}\r\n          {!isSubmitting && output && (\r\n            <pre className=\"whitespace-pre-wrap text-white\">{output}</pre>\r\n          )}\r\n          {!isSubmitting && !output && <p className=\"text-white/50\">Run {agent.name} to see results here.</p>}\r\n        </div>\r\n      </div>\r\n    </form>\r\n  );\r\n}\r\n"],"names":[],"mappings":"uCAEO,IAAM,EAAW,CAFH,QAAQ,GAAG,CAAC,wBAAwB,EAAI,uBAAA,EAExB,OAAO,CAAC,MAAO,mECApD,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OA0BO,SAAS,EAAY,OAAE,CAAK,CAAoB,EACrD,GAAM,CAAC,EAAW,EAAa,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAY,IACpD,EAAM,WAAW,CAAC,MAAM,CAAY,CAAC,EAAK,KACxC,CAAG,CAAC,EAAM,EAAE,CAAC,CApBnB,AAoBsB,SApBb,AAAgB,CAAsB,EAC7C,QAA2B,IAAvB,EAAM,KAA4B,OAAhB,CACpB,OAAO,EAAM,YAAY,CAG3B,OAAQ,EAAM,IAAI,EAChB,IAAK,eACH,MAAO,EACT,AADW,KACN,UACH,OAAO,CACT,KAAK,IACH,MAAO,EAGX,CACF,EAKsC,GACzB,GACN,CAAC,IAEA,CAAC,EAAc,EAAc,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACzC,CAAC,EAAQ,EAAU,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MAC9C,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAwB,MAE5C,EAAc,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,IAAM,CAAA,EAAG,EAAA,QAAQ,CAAC,cAAc,EAAE,EAAM,EAAE,CAAC,IAAI,CAAC,CAAE,CAAC,EAAM,EAAE,CAAC,EAExF,SAAS,EAAkB,CAAsB,CAAE,CAAU,EAC3D,EAAa,AAAC,IAAU,CACtB,EADqB,CAClB,CAAI,CACP,CAAC,EAAM,EAAE,CAAC,CAAE,CACd,CAAC,EACH,CAEA,eAAe,EAAa,CAAiC,EAC3D,EAAM,cAAc,GACpB,EAAS,MACT,EAAU,MACV,GAAc,GAEd,GAAI,CACF,IAAM,EAAM,MAAM,MAAM,EAAa,CACnC,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,KAAK,SAAS,CAAC,CAAE,MAAO,CAAU,EAC1C,GAEA,GAAI,CAAC,EAAI,EAAE,CAAE,CACX,IAAM,EAAU,MAAM,EAAI,IAAI,EAC9B,OAAM,AAAI,MAAM,GAAW,mBAC7B,CAEA,IAAM,EAAO,MAAM,EAAI,IAAI,GACrB,EAAO,GAAM,QAAQ,YAAc,KAAK,SAAS,CAAC,EAAM,KAAM,GACpE,EAAU,EACZ,CAAE,MAAO,EAAK,CACZ,EAAS,aAAe,MAAQ,EAAI,OAAO,CAAG,8BAChD,QAAU,CACR,GAAc,EAChB,CACF,CAwGA,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,SAAU,EAAc,UAAU,qEACtC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wEACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8CACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,4DAAmD,UAChE,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,kDAAyC,6BAEzD,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,2GACb,EAAM,WAAW,CAAC,MAAM,CAAC,gBAI9B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qBACZ,EAAM,WAAW,CAAC,GAAG,CAAE,AAAD,GACrB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAmB,UAAU,sBAC5B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sDACb,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,QAAS,EAAM,EAAE,CAAE,UAAU,sBACjC,EAAM,KAAK,GAEb,EAAM,QAAQ,EAAI,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,4DAAmD,gBA1HpG,AA4Ha,SA5HJ,AAAY,CAAsB,EACzC,IAAM,EACJ,uIAEF,OAAQ,EAAM,IAAI,EAChB,IAAK,WACH,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,WAAA,CACC,GAAI,EAAM,EAAE,CACZ,KAAM,EAAM,EAAE,CACd,SAAU,EAAM,QAAQ,CACxB,YAAa,EAAM,WAAW,CAC9B,UAAW,CAAA,EAAG,EAAY,uBAAuB,CAAC,CAClD,MAAO,CAAS,CAAC,EAAM,EAAE,CAAC,EAAI,GAC9B,SAAU,AAAC,GAAU,EAAkB,EAAO,EAAM,MAAM,CAAC,KAAK,GAGtE,KAAK,SACH,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CACC,GAAI,EAAM,EAAE,CACZ,KAAM,EAAM,EAAE,CACd,SAAU,EAAM,QAAQ,CACxB,UAAW,CAAA,EAAG,EAAY,aAAa,CAAC,CACxC,MAAO,CAAS,CAAC,EAAM,EAAE,CAAC,EAAI,GAC9B,SAAW,AAAD,GAAW,EAAkB,EAAO,EAAM,MAAM,CAAC,KAAK,YAEhE,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,MAAM,GAAG,QAAQ,CAAA,CAAA,WACtB,EAAM,WAAW,EAAI,qBAEvB,CAAC,EAAM,OAAO,EAAI,EAAE,AAAF,EAAI,GAAG,CAAE,AAAD,GACzB,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAA0B,MAAO,EAAO,KAAK,CAAE,UAAU,mCACvD,EAAO,KAAK,EADF,EAAO,KAAK,KAMjC,KAAK,eACH,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,GAAI,EAAM,EAAE,CACZ,KAAM,EAAM,EAAE,CACd,QAAQ,CAAA,CAAA,EACR,UAAW,CAAA,EAAG,EAAY,aAAa,CAAC,CACxC,MAAO,CAAS,CAAC,EAAM,EAAE,CAAC,EAAI,EAAE,CAChC,SAAU,AAAC,GACT,EACE,EACA,MAAM,IAAI,CAAC,EAAM,MAAM,CAAC,eAAe,EAAE,GAAG,CAAE,AAAD,GAAY,EAAO,KAAK,YAIxE,CAAC,EAAM,OAAO,EAAI,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAC1B,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAA0B,MAAO,EAAO,KAAK,CAAE,UAAU,mCACvD,EAAO,KAAK,EADF,EAAO,KAAK,IAMjC,KAAK,SACH,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,GAAI,EAAM,EAAE,CACZ,KAAM,EAAM,EAAE,CACd,KAAK,SACL,SAAU,EAAM,QAAQ,CACxB,YAAa,EAAM,WAAW,CAC9B,UAAW,EACX,MAAO,CAAS,CAAC,EAAM,EAAE,CAAC,EAAI,GAC9B,SAAU,AAAC,GAAU,EAAkB,EAA8B,KAAvB,EAAM,MAAM,CAAC,KAAK,CAAU,GAAK,OAAO,EAAM,MAAM,CAAC,KAAK,IAG9G,KAAK,UACH,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,QAAA,CAAM,UAAU,yDACf,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,GAAI,EAAM,EAAE,CACZ,KAAM,EAAM,EAAE,CACd,KAAK,WACL,UAAU,yFACV,SAAS,CAAQ,CAAS,CAAC,EAAM,EAAE,CAAC,CACpC,SAAU,AAAC,GAAU,EAAkB,EAAO,EAAM,MAAM,CAAC,OAAO,IAEpE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAM,EAAM,WAAW,EAAI,UAGlC,SACE,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,GAAI,EAAM,EAAE,CACZ,KAAM,EAAM,EAAE,CACd,KAAK,OACL,SAAU,EAAM,QAAQ,CACxB,YAAa,EAAM,WAAW,CAC9B,UAAW,EACX,MAAO,CAAS,CAAC,EAAM,EAAE,CAAC,EAAI,GAC9B,SAAU,AAAC,GAAU,EAAkB,EAAO,EAAM,MAAM,CAAC,KAAK,GAGxE,CACF,EAwByB,GACZ,EAAM,UAAU,EAAI,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCAAyB,EAAM,UAAU,KARnE,EAAM,EAAE,KAatB,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,KAAK,SACL,SAAU,EACV,UAAU,wNAET,EAAe,WAAa,cAG9B,GAAS,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,+FAAuF,OAGhH,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wEACb,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,4DAAmD,WAChE,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6CAAoC,YAClD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iGACZ,GAAgB,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,0BAAgB,WAAS,EAAM,IAAI,CAAC,OACjE,CAAC,GAAgB,GAChB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,0CAAkC,IAElD,CAAC,GAAgB,CAAC,GAAU,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,0BAAgB,OAAK,EAAM,IAAI,CAAC,mCAKpF"}